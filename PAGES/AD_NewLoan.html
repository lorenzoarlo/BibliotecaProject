<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="../STYLES/main-style.css" />
    <link rel="stylesheet" href="../STYLES/PersonalArea-style.css" />
    <link rel="stylesheet" href="../STYLES/input-style.css" />
    <link rel="stylesheet" href="../STYLES/Alert-style.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Dancing+Script" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Waiting+for+the+Sunrise" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" />
    <link rel="icon" type="image/png" href="../MEDIA/site-icon.png"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="../SCRIPTS/Utilities.js"></script>
    <script src="../SCRIPTS/Alert.js"></script>
    <script type="text/javascript">

        function insertRecord() {
            const QUERY_PATH = "../PHP_QUERIES/phpFunctions-Insert.php?tableName=loans";

            let classeAttuale = document.querySelector("#txtClasseAttuale").value;
            let codiceTessera = document.querySelector("#tableCodiceTessera").getRecordChecked();
            let numeroInventario = document.querySelector("#tableNInventario").getRecordChecked();
            
            let session = Utilities.GetSession();

            let toSend = new FormData();

            toSend.append("adminUsername", session["username"]);
            toSend.append("adminPassword", session["password"]);
            toSend.append("numeroInventario", numeroInventario);
            toSend.append("codiceTessera", codiceTessera);
            toSend.append("classeAttuale", classeAttuale);
            
            let alertContainer = document.querySelector(".default-container");

            fetch(QUERY_PATH, { method: "POST", body: toSend })
            .then(response => response.text())
            .then(function (response) {
                console.log(response);
                let output = JSON.parse(response);
                if(!output["authentication"]) {
                    new Alert("error", "Autenticazione amministratore fallita!", true, alertContainer);
                    return;
                }

                new Alert((output["inserted"]) ? "success" : "error", (output["inserted"]) ? "Inserimento effettuato con successo" : "Inserimento fallito!", true, alertContainer);
            });
        }
        
    </script>
    <title>Biblioteca I.T.T.S.</title>
</head>
<body>
    <header class="headbar-container">
        <span class="headbar-title">I.T.T.S. O. Belluzzi - L. da Vinci</span>
        <span class="headbar-subtitle">Area personale amministratore</span>
    </header>
    <section class="default-container">
        <span class="default-title">INSERIMENTO PRESTITO</span>
        <database-table table-name="usersNotLoan" 
        textbox-placeholder="Codice tessera utente"
        type="select"
        id="tableCodiceTessera">
            <database-column column-coding-name="codiceTessera" primary-key>CODICE TESSERA</database-column>
            <database-column column-coding-name="userMail">E-MAIL</database-column>
            <database-column column-coding-name="nomeCompleto">NOME</database-column>
            <database-column column-coding-name="codiceFiscale">CODICE FISCALE</database-column>
        </database-table>
        <database-table table-name="booksNotLoan" 
        textbox-placeholder="N° inventario libro"
        type="select"
        id="tableNInventario">
            <database-column column-coding-name="numeroInventario" primary-key>N° INVENTARIO</database-column>
            <database-column column-coding-name="titolo">TITOLO</database-column>
            <database-column column-coding-name="ISBN">ISBN</database-column>
            <database-column column-coding-name="descrizioneCategoria">CATEGORIA</database-column>
            <database-column column-coding-name="nomeCompletoAutore">AUTORE</database-column>
            <database-column column-coding-name="numeroScaffale">SCAFFALE</database-column>
        </database-table>
        <text-input type="text" placeholder="Classe attuale" id="txtClasseAttuale"></text-input>
        <button class="personalized-button green-button" onclick="insertRecord()">INSERISCI</button>
    </section>
    <script src="../SCRIPTS/TextInput.js"></script>
    <script src="../SCRIPTS/DatabaseTable.js"></script>
</body>
</html>